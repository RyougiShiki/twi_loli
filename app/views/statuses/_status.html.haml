- if status.retweeted_status
  - original_status = status
  - original_status.created_at = Time.zone.parse(original_status.created_at)

  - status = status.retweeted_status

- status.created_at = Time.zone.parse(status.created_at)

- mentioned_users = (extract_mentioned_users(status.text) - [current_user.screen_name, status.user.screen_name]).uniq

%li.status{:id => "status_#{status.id}", 'data-id' => status.id, 'data-user' => status.user.screen_name, 'data-mentioned-users' => mentioned_users.join(' ')}
  %span.thumb
    = link_to image_tag(status.user.profile_image_url, :alt => status.user.name, :size => '48x48'), user_path(status.user.screen_name), :title => status.user.name

  %span.status-body
    - if original_status.respond_to? :retweeted_status
      %span.retweet-icon

    %strong
      = link_to status.user.screen_name, user_path(status.user.screen_name), :title => status.user.name

    %span.content= raw format_tweet(status.text)

    %span.meta
      = link_to "#{distance_of_time_in_words_to_now(status.created_at, true)} ago", status_path(status.id), :title => status.created_at
      %span= raw "via #{status.source}"
      - if status.in_reply_to_status_id
        = link_to "in reply to #{status.in_reply_to_screen_name}", status_path(status.in_reply_to_status_id)

    - if original_status.respond_to? :retweeted_status
      %span.meta.retweet-meta
        %span
          = 'Retweeted by'
          = link_to original_status.user.screen_name, user_path(original_status.user.screen_name), :title => original_status.user.name
          %span{:title => original_status.created_at}= "#{distance_of_time_in_words_to_now(original_status.created_at, true)} ago"
          %span= raw "via #{original_status.source}"

    %ul.actions-hover
      %li
        %span.reply
          = link_to 'Reply', root_path(:in_reply_to => status.user.screen_name, :in_reply_to_status_id => status.id), :title => "Reply to #{status.user.screen_name}"
      - unless mentioned_users.empty?
        %li
          %span.reply-all
            = link_to 'Reply all', root_path(:in_reply_to => status.user.screen_name, :in_reply_to_status_id => status.id, :in_reply_to_mentioned_users => mentioned_users.join(' ')), :title => "Reply to #{mentioned_users.unshift(status.user.screen_name).to_sentence :last_word_connector => ' and '}"
      %li
        %span.retweet-with-comment
          = link_to 'Retweet with comment', root_path(:retweet_id => status.id), :title => 'Retweet with comment (Traditional RT)'
      %li
        %span.retweet
          = link_to 'Retweet', '#', :title => 'Retweet (Official RT)'
